![Yellowstone图像1](https://github.com/MorpheusAIs/Morpheus/assets/1563345/80a6c1cf-fe52-42ba-bfd4-91d9faf67f07)

# Morpheus “Yellowstone” 计算模型
### Erik Voorhees
### 2024年1月3日

对Morpheus代币经济结构的建议修订，用于在去中心化AI网络上激励计算。
查看Notion: https://defiant-wolfsbane-830.notion.site/Morpheus-Yellowstone-Compute-Model-2ca9b4e7e1374c898937fdbd1b964cc1


## 摘要
在Yellowstone计算模型中，Morpheus网络仅为实际提供的计算通过竞争性出价过程支付给提供者，并根据余额而非支付将IPS（每秒推断）的稀缺产出按比例分配给MOR代币持有者。这极大地改善了用户体验，同时最小化了Sybil漏洞。Yellowstone还引入了时间和通过/失败测试的重要指标，以确保提供者的响应速度和准确性。Yellowstone通过不通过路由器发送提示或结果，并将区块链交易最小化，以允许大规模操作。通过这种模型，MOR实现了基本价值，因为它使得无需每次推断都进行交易即可获得永久（虽然不是无限的）访问权限无需许可的计算资源。

如果采纳，本文将替代[Morpheus白皮书](https://github.com/MorpheusAIs/Morpheus/blob/main/!KEYDOCS%20README%20FIRST!/2.WhitePaper.md)中的“计算证明、注册与奖励”部分

## 背景
Morpheus使用代币经济学激励足够和可扩展的计算资源，以服务于去中心化和无需许可的生成性AI。在其最初的构想中，Morpheus直接按比例向计算提供者发放了24%的MOR排放量，这取决于收到的推断请求，它根据持有的MOR数量优先考虑对这些提供者的推断请求。

### 从原始白皮书中：
> “每个计算提供者通过费用燃烧的MOR比例交易费用，作为计算提供者地位的证明，并每天赚取一定比例的MOR代币。
>
> 例如，如果网络启动时有100个计算提供者，则每个人根据他们通过费用燃烧的MOR数量获得按比例的奖励。在这种情况下，假设每个计算提供者燃烧了100个MOR，那么每天的3,456个MOR代币中的1% = 34.56个MOR。”

### 这种方法存在三个主要问题：
1) 它要求用户支付每次推断的交易费用。即使很低，这也是相当大的摩擦，并将导致糟糕的用户体验，并且与OpenAI的用户体验相比永远处于劣势。它还至少需要每次推断一个区块链交易，这可能即使在L2上也不可扩展。每个推断事件的成本极低，如果需要区块链交易，经济学将不可行。
2) 这种模型极易被利用，因为计算提供者的预期收入远高于实际计算成本。因此，一个对手可以向他自己的计算提供者节点发送垃圾推断请求，并每天赚取相对较大部分的MOR代币，即使没有为任何人提供经济价值。可能会导致大量早期（未使用的）计算，一旦巨大的收入机会消失，这些计算就会消失，而在这个早期补贴上花费的MOR将被浪费/丢失。
3) 如果根据提供者持有的MOR数量优先处理推断请求，那么网络将忽视这些提供者的性能（响应时间）和推断处理的成本，而正是这两个因素网络应该尝试优化（响应时间和计算成本应该尽可能降低）。如果持有MOR最多的提供者使用的是他大学时代的200美元GPU，那么许多用户的推断性能将非常差。优先级应基于出价价格和性能，而不是MOR持有量。

下面提出的“Yellowstone”模型修改了Morpheus的计算提供代币经济学，以解决上述问题。无论分配给计算的排放量是多少，这种模型都有效，我们将假设保持24%的总排放量不变。

### 目标是：
1) 使用户不用支付每次推断的费用（理想情况下，根本不用支付）。
2) 实现高效、可扩展且可持续提供无需许可的计算资源，而不会为此支付过高价格。
3) 激励计算提供者之间的低响应时间和成本竞争。
4) 最小化区块链交易数量（无论是L2还是其他）。
5) 展示MOR具有经济上合理的基本需求。

## Yellowstone模型
涉及四个组件：

### 用户
* 有查询需求
* 想要快速/准确的计算，免费且无审查/监控

### 提供者
* 拥有计算资源
* 想要金钱（MOR）

### 路由器
* 高吞吐量处理引擎
* 去中心化

### 计算合约
* 无需许可的智能合约，接收MOR的排放，跟踪对提供者的贷记和借记，并在调用时支付给提供者。

## 标准权重和度量

人工智能中存在一个原子单位，以每秒推断次数（IPS）来衡量。这可以概念上与区块链上的wei相比较。推断用于定义Yellowstone路由器中的速率。因此，单个Morpheus AI单位的权重是一次推断。根据请求的类型，这可以应用于任何计算任务。

随着AI和区块链的共同点融合，Morpheus旨在提供一个开源的测量标准，以澄清AI和区块链双方使用的术语。

有两种类型的提示，由模型返回的响应大小定义：

**确定长度提示**，其中响应考虑返回的响应长度。这方面的例子有：
- 聊天/图像创建
- 疾病诊断
- 对象识别
- 欺诈检测

**不确定长度提示**需要响应后才能知道的资源。非确定性响应的示例提示包括：
- 唱一首关于意大利面的奏鸣曲。
- 生成一个生日快乐视频
- 将模型X与模型Y结合
- 将3D模型切片为.stl文件

Yellowstone专注于确定长度提示。所述路由器将以一种方式构建，以便将来处理不确定的提示，但今天不提供服务。为此，我们使用去中心化AI的标准化测量。

## DeAI速率

### 每秒推断的表达形式：

| 类型              | 响应           | 速率                    |
| ----------------- | -------------- | ----------------------- |
| 确定              | 语言           | 每秒推断的令牌数 (TPS)  |
| 不确定 - 媒体     | 音频           | 每秒推断的样本数 (ISPS) |
| 不确定 - 媒体     | 视频           | 每秒推断的帧数 (IFPS)   |
| 不确定 - 未来技术 | 未知的未来格式 | NA                      |

Yellowstone路由器的首个推断测量将是TPS。其他推断格式将随后推出。

### 时间

推断的区块时间为12秒，意味着每分钟5次，推断交易的一个区块被发布并记账。

## 定义

**“用户”**：定义为拥有MOR地址并向路由器发送请求的任何实体，使用计算资源。这可以是从Morpheus桌面节点发送请求的特定个人，也可以是机器人，或者是代表其最终用户与Morpheus网络交互的公司或第三方网站（最终用户的推断使用不被计算合约追踪或考虑，除非有推断失败）。

**“提供者”**：定义为运行节点提供计算资源的任何实体，拥有MOR地址并通过路由器提出IPS出价。当提供者从路由器中赢得出价时，提供者提供计算资源（GPU等）供各种AI模型给用户使用。

**“路由器”**：定义为拥有MOR地址的软件应用程序，协调用户和提供者之间的双边市场。路由器注册并跟踪提供者地址和出价，处理用户的请求，记录处理请求的[毫秒]和通过/失败测试，并指示计算合约支付合格提供者MOR作为报酬。路由器不发送或接收MOR交易（或任何区块链上的交易）。路由器不查看请求的内容或响应。

**“计算合约”**：定义为拥有MOR地址的智能合约，接收分配给计算桶的所有发出的MOR，跟踪欠合格提供者的金额，并在提供者请求支付时支付MOR给合格提供者。

**“每秒推断次数”(IPS)**：是AI中推断的原子单位。推断用于定义Yellowstone路由器中的速率。因此，单个Morpheus AI单位的权重是一次推断。

**“IPSMax”**：指路由器接受支付的最大IPS数量。

**“RFC”**：代表“计算请求”。用户向路由器发送一个RFC，并指定用户希望访问的[LLM]以及[IPSMax]，即对响应中可接受IPS的上限。用户会想要设置这个上限，因为较高的数字=更长的等待答案时间，并且更多地计入[UserMax]，每天都是有限的。

### 合约保护

为了防止通过使用任何未使用的计算资源来操纵MOR数量的攻击，分配给计算提供者的未使用MOR池每个区块日最多只能减少1%。这等于正常的计算排放+1%。

### 计算引导激励

在资本合约的引导期之后的第一年，前100名计算提供者将有权按比例获得2.4%的MOR排放量。这由路由器计算并在计算合约中记账。

## 工作流程
1) 用户、提供者和路由器都创建MOR公钥（这是他们的身份，所有消息都这样签名）。
2) 如果用户持有任何数量的MOR余额，用户可以向路由器提交一个签名的“计算请求”（RFC）消息。用户指定[LLM]和[IPSMax]。
3) 路由器根据用户的MOR余额优先考虑RFC（解决sybil问题）。
4) 路由器选择支持[LLM]的提供者，优先考虑每个IPS的最低出价。
5) 路由器向提供者发送活性检查。如果通过，则
6) 路由器将用户连接到提供者。
7) 用户向提供者发送查询（[LLM],[提示]）。
8) 提供者计算查询，将结果发送给用户。
9) 用户向路由器报告第4步和第5步之间的时间[毫秒]，提供的[ISP]和[通过/失败]。
10) 如果[毫秒]每[IPS]不低于过去Z次查询该[LLM]的平均值的X%，且用户报告[通过]，路由器指示计算合约给提供者记入MOR。
11) （稍后某个时间）提供者从计算合约请求MOR支付，如果有效（到目前为止的第一个区块链交易，可以批量处理），计算合约发送MOR支付。

![计算合约 图2](https://github.com/MorpheusAIs/Morpheus/assets/1563345/e66ea20c-9851-4f9e-9caa-66c6d798c462)

## 结果
* 用户快速收到查询结果，且不需支付任何费用（这将带来惊人的用户体验，从而促进采用）。**解决目标1。**
* 通过竞争性出价过程，计算合约为计算支付，且由下单的用户进行质量/满意度检查。**解决目标2。**
* 只要响应足够快，提供者就能从计算合约获得金钱（MOR）。提供者获得了他为提供计算所要求的确切金额。如果他的要价过高，其他人会出更低的价，因此系统是高效的，并将驱使提供者价格向基本电力成本靠拢。**解决目标3**
* 最小化了链上交易的数量（成千上万的查询可以进行而不需任何链上交易）。**解决目标4**
* 获得快速、免费计算的能力驱动了用户持有MOR代币的需求。**解决目标5**
* 第6步和第7步提供合理的隐私（查询从不触及路由器，结果也是如此）。提供者被某种随机选择，且除了IP地址外不知道用户的身份。通过TOR + FHE可以实现更好的隐私保护
* 从计算合约中减少了MOR余额。只要支付的MOR < 每个周期从排放中赚取的MOR，合约就会有偿。
* 如果用户发送的RFC超过了用户的UserMax，路由器将拒绝该请求。

—-------------

## 计算预算
Morpheus网络需要确定在给定期间（如每天）愿意在计算上花费多少MOR，这称为计算预算。每个周期，计算合约最多可以花费这么多MOR。这个数字乘以MOR价格给我们每天购买计算的美元预算。

## 访问率
Morpheus网络通过“访问率”概念分配IPS生产的稀缺资源。访问率决定了每个MOR代币每天可以访问多少IPS。未使用的访问不会累积。访问率始终显示为每1 MOR代币的IPS数量（如1 MOR = 15,000 IPS）。访问率部分由MaxIPS决定，后者量化了网络每天可以购买的最大IPS数量。

**访问率** = (1/MOR供给) * MaxIPS
**MaxIPS** = ((MOR计算预算 * MOR价格) / IPS价格) * 1000
**UserMax** = 访问率 * 用户MOR余额

### 示例假设：
**MOR供给** = 10,000,000 MOR代币
**MOR计算预算** = 每天3,000 MOR代币
**MOR价格** = $20
**IPS价格** = 每1000 IPS $0.002
**用户余额** = 5 MOR代币

### 示例结果：
**MaxIPS** = 30,000,000,000 IPS（这是网络每天可以购买/生产的最大IPS数量）
**访问率** = 3,000（因此每个MOR代币每天授予3,000 IPS的访问权）
**UserMax** = 15,000（拥有5个MOR代币的用户每天可以访问多达15,000 IPS）

- 每个周期（每天），Morpheus作为一个网络有足够的资金从计算提供者那里购买X数量的IPS。X是计算合约愿意花费的金额（“计算预算”）乘以当前MOR价格除以IPS市场率的函数。
- 如果计算预算是3,000 MOR，每个价值$20，那么网络那天可以购买（生产）多达$60,000的IPS。如果1,000 IPS的市场价是$0.002，那么网络最多可以购买30亿IPS（30m x 1000 IPS）。
- 这30亿IPS的潜在产量按MOR余额比例分配。假设存在10,000,000 MOR。拥有500 MOR代币（总量的0.005%）的用户那天可以免费访问多达1.5m IPS。
- 只要计算预算在排放水平或以下，计算合约就不会耗尽MOR。
- 实际上，大多数MOR代币将存放在钱包和交易所中，只有一小部分将用于需求IPS生产。

## 注释
* MOR的根本需求来自希望在Morpheus网络上访问生成性AI和其他形式计算的用户。

* 提供者的硬件类型对网络来说无关紧要，只要他们满足用户的通过/失败测试。任何对更多查询出价超过他们能有效处理的提供者将因未通过此测试而受到惩罚。

* 上述模型重要地仅在有对其计算的需求时支付给提供者。这避免了当网络不需要时过早发放大量MOR的情况。

* 提供者应该需要证明他们拥有给定LLM，通过使用他们的密钥签名LLM模型的哈希。这并不能证明他们使用了它，但证明了他们下载并安装了它，这代表了一些工作，从而防止了某些形式的对sybil敏感的欺诈。如果提供者向用户提供垃圾结果，用户可以将[失败]及[毫秒]一起发送回路由器，那么提供者将不会因那次计算而获得记账。Morpheus不需要所有答案都是完美的……它只需要足够多的答案足够好，相对于竞争对手来说。

* 通过访问率防止了用RFC淹没网络的Sybil攻击。发送RFC的“成本”是获得一个MOR代币的成本除以代表其提交的RFC数量。因此成本从未为零，但每次制作RFC时用户不会感到损失。

* 通过/失败由用户决定，并在一定程度上监控质量。用户将通过/失败结果连同[毫秒]一起传达给路由器。如果失败，要么没有奖励要么罚分（待定）。虚假失败提供者没有激励（这样做没有金钱上的激励）。这一机制防止了提供者发送快速但无用的结果。
考虑：如果用户MOR > 提供者MOR，可能仅在失败时无奖励。否则，只是一个负面点数，路由器可以在其优先权逻辑中使用。

* 四方（用户、提供者、路由器和计算合约）都有唯一的MOR地址作为他们的身份。所有方之间的消息都需要签名（但大多数不需要区块链交易）

* 提供者必须有非零余额以防止提供者方的Sybil攻击。

* 如果[毫秒]标准更高，网络将总体上更快，但会阻碍小型提供者

* 提供慢速结果有不利因素（计算后无收入）
